layout: article
title: 图片压缩以加快网站访问速度
date: 2016-12-25 22:09:18
tags:
	- CDN
	- Server
	- 网站优化
	- 图片压缩
---

{% imgurl assets/images/a/image-compression/1.jpg %}

语文功底不好的我，绞尽脑汁写了几篇文章发布到服务器上，
由于这其中包含了不少图片，测试访问速度并不理想，体验很差。
虽然Hexo已经将网站转为静态页面了，性能提升很多，
但毕竟用的github空间，不花钱，已经算是很不错的了。
因此，只能先从图片上下功夫，至于js和css暂时不管。

网上找了很多优化方法，最终决定将图片资源托管至七牛CDN，
不过据说后期图片多了会依赖它，然后慢慢你的钱包就分了一部分给它，
我想七牛做得好才会由用户依赖吧（这里没有要给七牛做广告的意思），
另外现在对我的博客来说还不到后期，将来的事情谁又知道呢~

确定好方案，那就开整吧。

<!-- more -->

##### 开通七牛CDN服务

完成下列步骤即可：

1. 注册[七牛云]账号

2. 实名认证

3. 新建对象存储

&emsp;&emsp;官网[存储]快速入门文档。
4. 绑定加速域名

&emsp;&emsp;官网[融合CDN加速]快速入门文档。

完成上述步骤再通过下面的工具将本地文件上传即可使用。

##### 自动同步插件

首先根据网友推荐使用了一款插件：[hexo-qiniu-sync]。
按照插件作者的描述，通过配置七牛的密钥，资源文件夹路径，
然后在文章中插入特定标签，生成静态文件时，即可自动同步图片到七牛服务器。

看起来貌似很方便，而且也有不少人使用，到我手里就变了样。
按照文档安装后并且配置七牛密钥后，运行这个插件时报错，
导致不仅无法上传图片，而且本地预览文章都不行。

我也到讨论区看了，有同样的错误，但是作者没有在线，据说是忙于搬家大业。
多次尝试无果，只好摒弃这个好用的插件（如果能用的朋友，请在评论区留言）。

##### 手动同步工具

来到七牛官网，找到了一个文件上传工具：[qshell]。
经过一番倒腾，终于把图片文件夹弄到七牛服务器上了，
详细操作步骤请看文档：[qshell使用]。
只不过每次有文件变动，需要手动执行命令，有点不太方便。

<br/>

以上方式治标不治本，虽然速度能够提升，但非常有限。

##### 图片压缩

围绕图片做优化，怎么能忘记它本身，
如果有一张1000M的图片，就算使用CDN能提高多少速度，
所以只有图片大小相对较小，才能更好的提升速度。

这里的相对较小，并不是能将1000M的图片变到1M，
而是在同等宽高、画质差别不大的情况下进行图片压缩处理，
使图片占用空间相较原图更小。

1. 图片格式

&emsp;&emsp;读者可以了解下[图片格式]，并且选择某种格式来作为网站基准。
当然，我推荐尽量使用JPEG(Joint Photographic Expert Group)，联合照片专家组，
文件后缀名为“.jpg”或“.jpeg”，因为它是目前网络上最流行的图像格式，
并且可以把文件压缩到最小，画质还不会收到太大的影响。

2. 在线压缩工具

&emsp;&emsp;首先想到的就是利用[在线压缩]工具，我尝试把一张300K的jpg图片压缩，
结果得到的图片只有20K，画质不会太差，这让我非常满意，于是继续压缩其他图片文件，
最后整个3M的图片文件夹被我变成了400K左右，然后生成静态页面，发布到服务器。
果然，访问速度得到大大改善。
<small>_Tips：图片色彩差别最好不要太大，可以使用调色工具优化，否则压缩结果不会让你高兴。_</small>

3. 图片压缩软件

&emsp;&emsp;如果图片太多，可以使用[智图]进行批量压缩，非常方便，安装完毕后，
直接将图片文件夹拖入软件中，即时压缩，并且可以自定义压缩比例。

4. 图片格式转码

&emsp;&emsp;直接修改后缀名？No,No,No！因为这样并没有真正修改格式，
并且智图也不支持压缩这种类型的图片，那如何批量修改图片的后缀？
推荐使用[美图秀秀批处理]（可能需要先安装美图秀秀），和智图一样直接拖放。
在软件右侧选择更多->选择jpg格式->修改画质（建议60%-80%）：

{% imgurl assets/images/a/image-compression/2.jpg %}

当然，你还可以用它添加水印，做做美化什么的，更多功能需要自己去发现~

##### 最后

压缩完图片后，结合CDN存储方式，整个网站访问起来就更快了，
把js、css也一并放到CDN下也能提升速度，方法就不多说了。 
如果您有更好的优化方法，请在评论区留言！

  [七牛云]: http://www.qiniu.com/
  [存储]: http://developer.qiniu.com/article/fusion/api/quickstart.html
  [融合CDN加速]: http://developer.qiniu.com/article/kodo/kodo-first/quickstart.html
  [hexo-qiniu-sync]: https://github.com/gyk001/hexo-qiniu-sync
  [qshell]: http://developer.qiniu.com/code/v6/tool/qshell.html#download
  [qshell使用]: http://developer.qiniu.com/code/v6/tool/qshell.html#using
  [图片格式]: http://baike.baidu.cn/view/19666.htm
  [在线压缩]: http://www.asqql.com/gifzip/
  [智图]: http://zhitu.isux.us/
  [美图秀秀批处理]: http://xiuxiu.meitu.com/tutorial/nh_25.html